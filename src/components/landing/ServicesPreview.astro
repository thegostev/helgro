---
// Assets
import { Image } from "astro:assets";
import i1 from "/src/images/services/1.png";
import i2 from "/src/images/services/2.png";
import i3 from "/src/images/services/3.png";
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Kicker from "@/components/fundations/elements/Kicker.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import RollingLink from "@/components/fundations/elements/RollingLink.astro";
// Content
import { getCollection } from "astro:content";
const allServices = await getCollection("services");
// Sort by some order, perhaps by title or add order in frontmatter
const sortedServices = allServices
  .sort((a, b) => a.data.title.localeCompare(b.data.title))
  .slice(0, 3);
const serviceImages = [i1, i2, i3];
---

<footer class="overflow-hidden">
  <Wrapper variant="wide" class="py-4">
    <div class="relative rounded-3xl h-[calc(100vh-2rem)] overflow-hidden">
      <div>
        {
          serviceImages.map((img, index) => (
            <Image
              id={`service-image-${index}`}
              src={img}
              alt={sortedServices[index]?.data.title}
              width={1440}
              height={1440}
              class="object-cover size-full absolute inset-0 object-center"
              style={`display: ${index === 0 ? "block" : "none"}`}
            />
          ))
        }
      </div>
      <div class="relative lg:max-w-xl lg:ml-auto flex flex-col h-full">
        <div
          class="p-8 bg-base-100 m-4 rounded-2xl h-full justify-between flex flex-col"
        >
          <Kicker copy=" Services" />
          <Text
            tag="p"
            variant="displaySM"
            class="text-base-900 font-medium tracking-tight lg:text-balance mt-12"
          >
            Leading sustainable interior design services that integrate
            ecofriendly materials and energy efficient solutions.
          </Text>
          <div class="divide-y border-y divide-base-200 border-base-200 mt-8">
            {
              sortedServices.map((service, index) => (
                <button
                  class={`text-left w-full group transition-all text-base-900 py-2  ${index === 0 ? "" : "opacity-50"}`}
                  data-service-index={index}
                >
                  <Text
                    tag="p"
                    variant="textLG"
                    class="font-medium group-focus:translate-x-4 duration-500 ease-in-out transition-all"
                  >
                    {service.data.title}
                  </Text>
                </button>
              ))
            }
          </div>
          <Text
            tag="p"
            variant="textBase"
            class="text-base-600 text-balance mt-8"
            id="active-description"
          >
            {sortedServices[0]?.data.description}
          </Text>
          <RollingLink
            href="/services"
            variant="light"
            hoverText="Explore now"
            initialText="See all services"
            class="mt-8"
          />
        </div>
      </div>
    </div>
  </Wrapper>
</footer>
<script define:vars={{ sortedServices }}>
  window.sortedServices = sortedServices;
  const buttons = document.querySelectorAll("[data-service-index]");
  const images = document.querySelectorAll("[id^='service-image-']");
  const descriptionEl = document.getElementById("active-description");
  buttons.forEach((button, index) => {
    button.addEventListener("click", () => {
      // Update active tab
      buttons.forEach((btn, i) => {
        if (i === index) {
          btn.classList.remove("opacity-50");
        } else {
          btn.classList.add("opacity-50");
        }
      });
      // Update visible image
      images.forEach((img, i) => {
        img.style.display = i === index ? "block" : "none";
      });
      // Update description
      descriptionEl.textContent = window.sortedServices[index].data.description;
    });
  });
</script>
